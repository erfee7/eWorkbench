services:
  nginx:
    # ----------------------------
    # Ports (choose ONE block)
    # ----------------------------

    # Production (recommended): nginx listens on standard ports
    ports:
      - "80:80"
      - "443:443"

    # # Local HTTPS testing (uncomment to use):
    # ports:
    #   - "3000:80"
    #   - "3443:443"

    volumes:
      # Base mounts MUST be repeated here (override lists replace lists)
      - ./docker/nginx/nginx.conf:/etc/nginx/nginx.conf:ro,Z
      - ./docker/nginx/conf.d:/etc/nginx/conf.d:ro,Z

      # ----------------------------
      # Certificates (choose ONE block)
      # ----------------------------

      # (A) Production certs: Let's Encrypt on the host
      # Replace app.example.com with your domain
      - /etc/letsencrypt/live/app.example.com/fullchain.pem:/etc/nginx/certs/fullchain.pem:ro,Z
      - /etc/letsencrypt/live/app.example.com/privkey.pem:/etc/nginx/certs/privkey.pem:ro,Z

      # # (B) Local testing certs (self-signed / mkcert)
      # - ./docker/nginx/certs:/etc/nginx/certs:ro,Z


  # =====================================================================
  # web: choose ONE block below (build from source OR use the GHCR image)
  # =====================================================================

  # # ----------------------------
  # # Option 1: BUILD FROM SOURCE (default for local development)
  # # ----------------------------
  # web:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   image: eworkbench

  # ----------------------------
  # Option 2: USE PRE-BUILT IMAGE (recommended for small VPS)
  # ----------------------------
  web:
    image: ghcr.io/erfee7/eworkbench:latest

    # Try to disable build in case your Compose merges it; still run with --no-build.
    build: null